%define with_python2 %{?_without_python2:0} %{?!_without_python2:1}

Summary: OpenTestPoint EMANE Probe
Name: opentestpoint-probe-emane
Version: @VERSION@
Release: 1%{?dist}
License: BSD
Group: Applications/System
URL: https://github.com/adjacentlink/opentestpoint-probe-emane
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root

%if %{?_with_python2:1}%{!?_with_python2:0}
%if 0%{?fedora} >= 26
Requires: python2-opentestpoint python2-emane python2-lxml
%define use_python_sitelib %{python2_sitelib}
%else
Requires: python-opentestpoint python-emane python-lxml
%define use_python_sitelib %{python_sitelib}
%endif
%else
Requires: python3-opentestpoint python3-emane python3-lxml
%define use_python_sitelib %{python3_sitelib}
%endif

Vendor: Adjacent Link LLC
BuildArch: noarch

%description
OpenTestPoint EMANE Probe

%prep
%setup -q

%build
%if %{?_with_python2:1}%{!?_with_python2:0}
%configure --with-python2
%else
%configure
%endif
make

%install
make DESTDIR=${RPM_BUILD_ROOT} install
%if 0%{?el6}
cp otestpoint/emane/*.xsd ${RPM_BUILD_ROOT}/%{prefix}/lib/python2.6/site-packages/otestpoint/emane
cp otestpoint/emane/*.proto ${RPM_BUILD_ROOT}/%{prefix}/lib/python2.6/site-packages/otestpoint/emane
%endif

%clean
rm -rf $RPM_BUILD_ROOT

%post
/sbin/ldconfig

%postun
/sbin/ldconfig

%files
%defattr(-,root,root,-)
%{use_python_sitelib}/*

%doc AUTHORS
%doc COPYING
%doc NEWS
%doc README
%doc INSTALL
